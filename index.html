<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gaia Demo</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#07130a; --panel:#0b1a0f; --ink:#eef7f0; --muted:#a6cdb3; --edge:rgba(255,255,255,.07);
  --brand:#4cc26f; --brand2:#2aa38f;
  --chipbg:rgba(114,206,155,.14); --chipbr:rgba(114,206,155,.22);
  --ring:rgba(76,194,111,.18);
}

*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--ink);font-family:"Plus Jakarta Sans",system-ui,Arial,sans-serif}

/* layout */
.wrap{max-width:1200px;margin:0 auto;padding:16px}
.screen{position:relative;display:none;opacity:0;transform:translateY(8px);transition:opacity .35s,transform .35s}
.screen.active{display:block;opacity:1;transform:none}

/* === Sticky stepper with progress === */
.sticky{
  position:sticky;top:0;z-index:40;
  background:linear-gradient(180deg,rgba(7,19,10,.86),rgba(7,19,10,.48));
  backdrop-filter:blur(8px);
  border-bottom:1px solid var(--edge)
}
.stepper{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;padding:10px}
.stepper button{
  background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03));
  border:1px solid var(--edge);border-radius:999px;color:var(--ink);
  font-weight:700;font-size:.86rem;padding:.5rem .8rem;cursor:pointer
}
.stepper button.active{border-color:rgba(114,206,155,.5);box-shadow:0 0 0 2px rgba(114,206,155,.22) inset}
.progress{height:3px;background:var(--edge);border-radius:999px;overflow:hidden;margin:0 16px 8px}
.progress span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--brand),var(--brand2))}

/* Slide counter: tiny label, no bubble */
.step-count{
  position:absolute;
  top:6px;
  left:50%;
  transform:translateX(-50%);
  display:inline-block;
  white-space:nowrap;
  pointer-events:none;
  padding:2px 6px;
  border:0;
  background:transparent;
  color:rgba(239,252,244,.95);
  font-weight:800;
  font-size:.85rem;
  letter-spacing:.06em;
  text-shadow:0 1px 2px rgba(0,0,0,.7), 0 0 10px rgba(0,0,0,.45);
  z-index:3;
}

/* === Slide 1 hero uses background.png directly === */
.hero{
  border-radius:28px; padding:110px 20px 74px;
  background:#09170e url("background.png") center / cover no-repeat;
  text-align:center; isolation:isolate;
  box-shadow:0 14px 44px rgba(0,0,0,.38); overflow:hidden;
  min-height:clamp(520px,70vh,760px);
}
.hero::after{
  content:""; position:absolute; inset:0; z-index:0;
  background:
    radial-gradient(1200px 560px at 64% 8%, rgba(255,230,150,.16), transparent 60%),
    linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,.28) 55%, rgba(0,0,0,.55) 100%);
}
.hero > *{ position:relative; z-index:1; }

h1{font-size:clamp(34px,5.4vw,60px);line-height:1.04;margin:0 0 18px;font-weight:800;letter-spacing:.005em}
.chip{display:inline-block;margin:6px 0 12px;padding:6px 14px;border-radius:999px;
  color:#b3f2cd;background:var(--chipbg);border:1px solid var(--chipbr);font-weight:800;letter-spacing:.02em}
.lead{max-width:880px;margin:12px auto 8px;color:#d9efe4;font-size:1.08rem;line-height:1.7}
.sub{max-width:880px;margin:8px auto 24px;color:#a7cdb5}

/* Buttons */
.btn{border-radius:14px;font-weight:800;cursor:pointer;padding:.95rem 1.28rem;border:1px solid transparent}
.btn.primary{background:linear-gradient(180deg,#7fe09f,#3abf97);color:#05140c;border:0;box-shadow:0 12px 30px rgba(58,191,151,.32);transition:transform .12s,filter .12s,box-shadow .12s}
.btn.primary:hover{transform:translateY(-1px);filter:brightness(1.05);box-shadow:0 16px 38px rgba(58,191,151,.44)}
.btn.ghost{background:rgba(255,255,255,.03);color:#d9efe4;border-color:var(--edge);backdrop-filter:blur(2px)}
.cta{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}

/* Pills & popovers */
.pills{display:flex;gap:14px;justify-content:center;flex-wrap:wrap;margin-top:26px;color:#a7cdb5}
.pill{display:inline-flex;align-items:center;gap:10px;padding:8px 12px;border:1px solid var(--edge);border-radius:999px;background:rgba(255,255,255,.03);color:#d9efe4;cursor:default;position:relative}
.pill:hover,.pill:focus{border-color:rgba(114,206,155,.35);box-shadow:0 0 0 2px rgba(114,206,155,.18) inset;outline:none}
.pill .dot{width:8px;height:8px;border-radius:50%;background:linear-gradient(180deg,var(--brand),var(--brand2));box-shadow:0 0 0 2px rgba(76,194,111,.20)}
.pill .popover{
  position:absolute;left:50%;bottom:calc(100% + 10px);transform:translate(-50%,-6px);
  width:min(520px, calc(100vw - 48px));padding:12px 14px;border-radius:14px;border:1px solid var(--edge);
  background:rgba(11,26,15,.96);color:#e9f4ee;box-shadow:0 12px 30px rgba(0,0,0,.35);
  opacity:0;pointer-events:none;transition:opacity .15s, transform .15s;text-align:left;z-index:5
}
.pill .popover::after{content:"";position:absolute;top:100%;left:50%;transform:translateX(-50%);border:8px solid transparent;border-top-color:rgba(11,26,15,.96)}
.pill .popover ul{margin:.4rem 0 .25rem;padding-left:1.1rem}
.pill .popover li{margin:.15rem 0}
.pill:hover .popover,.pill:focus .popover,.pill[data-open="true"] .popover{opacity:1;pointer-events:auto;transform:translate(-50%,-2px)}
.hero .pills{position:relative;z-index:2}

/* === Generic panels === */
.panel{background:transparent;border-radius:28px;padding:32px 16px 26px;box-shadow:0 12px 40px rgba(0,0,0,.35);overflow:hidden}
h2{margin:8px 0 14px;text-align:center;font-size:clamp(24px,3.6vw,36px)}
.center{text-align:center}.muted{color:var(--muted)} .tiny{font-size:.92rem}

/* >>> Apply background image to panels too <<< */
.panel.with-bg{
  min-height:clamp(520px,70vh,760px);
  background:#09170e url("background.png") center / cover no-repeat;
}
.panel.with-bg::after{
  content:""; position:absolute; inset:0; z-index:0;
  background:
    radial-gradient(1200px 560px at 64% 8%, rgba(255,230,150,.12), transparent 60%),
    linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,.28) 55%, rgba(0,0,0,.55) 100%);
}
.panel.with-bg > *{position:relative; z-index:1}

/* ========= NEW: Slide 2 ‚Äî three interactive images ========= */
  .step-viewport{max-width:820px;margin:10px auto 16px}
.demo-step{display:none}
.demo-step.active{display:block}

.step-tab{
  cursor:pointer; background:rgba(255,255,255,.06);
  border:1px solid var(--edge); border-radius:999px;
  padding:6px 12px; font-weight:700; color:#eaf6ef;
}
.step-tab.active{border-color:rgba(114,206,155,.5); box-shadow:0 0 0 2px rgba(114,206,155,.22) inset}

.step-pills{
  display:flex; gap:10px; justify-content:center; flex-wrap:wrap;
  margin:6px 0 14px;
}
.step-pills .pill{
  background:rgba(255,255,255,.06);
  border:1px solid var(--edge);
  border-radius:999px; padding:6px 12px; font-weight:700; color:#eaf6ef;
}
.step-pills .sep{width:48px; height:2px; align-self:center; background:var(--edge); border-radius:999px}

.threeup{
  --min:280px;
  display:grid; grid-template-columns:repeat(auto-fit,minmax(var(--min),1fr)); gap:12px;
  max-width:1060px; margin:10px auto 16px;
}
.card2{padding:14px 12px; border-radius:16px; background:rgba(255,255,255,.04); border:1px solid var(--edge)}
.card2 h3{margin:2px 0 8px}
.frame{
  position:relative; height:210px;
  border-radius:14px; border:1px solid var(--edge);
  background:rgba(0,0,0,.18); overflow:hidden; box-shadow:0 8px 22px rgba(0,0,0,.24) inset;
}
.caption{margin-top:8px; color:var(--muted); font-size:.92rem; text-align:center}

/* map / boundary ‚Äúimage‚Äù */
.map-grid{
  position:absolute; inset:0; background:
    linear-gradient(transparent 31px, rgba(255,255,255,.06) 32px),
    linear-gradient(90deg, transparent 31px, rgba(255,255,255,.06) 32px);
  background-size:32px 32px;
  filter:contrast(.9) brightness(.9);
}
.boundary{
  position:absolute; inset:10% 8% 18% 10%;
  border:3px dashed #ffd665; border-radius:40% 50% 42% 48% / 44% 40% 52% 46%;
  animation:pulse 1.6s ease-in-out infinite;
}
@keyframes pulse{
  0%,100%{box-shadow:0 0 0 0 rgba(255,214,101,.25)}
  50%{box-shadow:0 0 0 6px rgba(255,214,101,.12)}
}
.cursor{
  position:absolute; right:16px; bottom:16px; width:26px; height:26px;
  background:radial-gradient(circle at 40% 40%, #fff 0 50%, #dfe7ea 52% 100%);
  clip-path:polygon(0 0, 0 100%, 48% 64%, 100% 100%, 58% 40%, 100% 0);
  filter:drop-shadow(0 2px 4px rgba(0,0,0,.35));
}

/* satellite split ‚Äúimage‚Äù */
.split{position:absolute; inset:0; display:grid; grid-template-columns:1fr 1fr}
.split .a{background:radial-gradient(ellipse at 45% 55%, #1e402c 0, #0f2618 60%)}
.split .b{background:radial-gradient(ellipse at 55% 50%, #2b7a50 0, #123624 70%)}
.status-badge{
  position:absolute; right:12px; top:12px;
  padding:7px 12px; border-radius:999px; font-weight:800; font-size:.85rem;
  border:1px solid var(--edge); background:rgba(0,0,0,.34); color:#e9f6ef;
}
.status-badge.ok{background:rgba(61,184,129,.22); border-color:rgba(61,184,129,.42)}
.status-badge.flag{background:rgba(235,188,84,.20); border-color:rgba(235,188,84,.44)}

/* gauge ‚Äúimage‚Äù */
.gauge{
  --p: 0.72; /* 0‚Äì1 */
  --deg: calc(var(--p) * 270deg);
  position:absolute; inset:16px; display:grid; place-items:center;
  background:
    radial-gradient(closest-side, transparent 76%, rgba(0,0,0,.18) 77% 78%, transparent 79%),
    conic-gradient(from -225deg, var(--brand) 0 var(--deg), rgba(255,255,255,.08) var(--deg) 270deg, transparent 0);
  border-radius:14px;
}
.gauge .big{font-size:42px; font-weight:800}
.gauge .small{color:#bfe6d1}
.wallet{position:absolute; left:14px; bottom:14px; width:30px; height:22px; border-radius:6px; background:#0e2218; border:1px solid var(--edge)}
.coin{position:absolute; left:calc(14px + 8px); bottom:42px; width:12px; height:12px; border-radius:50%;
  background:radial-gradient(circle at 30% 30%, #ffe89a 0, #ffc24a 60%, #e0a532 100%);
  opacity:0; transform:translateY(0); pointer-events:none;
}
.coin.drop{animation:coinFall 900ms ease-out forwards}
@keyframes coinFall{
  0%{opacity:.0; transform:translateY(-14px)}
  30%{opacity:1}
  100%{opacity:0; transform:translateY(8px)}
}

/* small controls inside cards */
.row-mini{display:flex; gap:8px; justify-content:center; flex-wrap:wrap; margin-top:8px}
.tag-mini{font-size:.78rem; padding:4px 8px; border-radius:999px; border:1px solid var(--edge); background:rgba(255,255,255,.06)}
.btn.tiny{padding:.55rem .8rem; font-size:.9rem; border-radius:10px}

/* reduced motion */
@media (prefers-reduced-motion:reduce){ .screen{transition:none} }
</style>
</head>

<body>
<div class="sticky">
  <div class="stepper" aria-label="Demo steps">
    <button class="tab active" data-goto="1">Intro</button>
    <button class="tab" data-goto="2">Land joins</button>
    <button class="tab" data-goto="3">Funding</button>
    <button class="tab" data-goto="4">Payouts</button>
    <button class="tab" data-goto="5">Trust</button>
  </div>
  <div class="progress"><span id="progressLine"></span></div>
</div>

<div class="wrap">

  <!-- Slide 1 -->
  <section class="screen hero active" data-screen="1" aria-live="polite">

    <h1>When nature improves, Gaia pays you.</h1>
    <div class="chip">What is Gaia?</div>
    <p class="lead">
      Gaia is a decentralised crypto system that automatically rewards verified land owners for restoring and maintaining healthy ecosystems - funded by companies and donors who want real, measurable impact.
    </p>
    <p class="sub">
      Gaia Coin rewards care twice - payouts for verified health today and a supply designed to become scarcer as global recovery grows - plus you use it to vote on how Gaia works.
    </p>

    <div class="cta">
      <button class="btn primary" data-next="2">Start the demo</button>
      <button class="btn ghost" data-next="2">See how it works</button>
    </div>

    <!-- Interactive pills with hover/tap popovers -->
    <div class="pills" role="group" aria-label="Highlights">
      <span class="pill" role="button" tabindex="0" aria-haspopup="dialog" aria-label="Satellite evidence details">
        <span class="dot" aria-hidden="true"></span> Satellite evidence
        <span class="popover" role="dialog" aria-label="Satellite evidence">
          <strong>Open satellite data</strong>
          <ul>
            <li>Public, independent satellites show whether land is truly getting healthier.</li>
            <li>Signals: greener vegetation, stable water/soil, fewer disturbances.</li>
            <li>Transparent sources so anyone can verify.</li>
          </ul>
          <div class="tiny muted">Sources: Sentinel-2, Landsat (10‚Äì30 m resolution).</div>
        </span>
      </span>

      <span class="pill" role="button" tabindex="0" aria-haspopup="dialog" aria-label="Public registry details">
        <span class="dot" aria-hidden="true"></span> Public registry
        <span class="popover" role="dialog" aria-label="Public registry">
          <strong>Open list of verified land</strong>
          <ul>
            <li>We use a public list of every verified parcel showing its map boundary, health score, and status. Anyone can check it, and the history stays on record.</li>
          </ul>
          <div class="tiny muted">Every update is time-stamped and signed.</div>
        </span>
      </span>

      <span class="pill" role="button" tabindex="0" aria-haspopup="dialog" aria-label="Payouts ledger details">
        <span class="dot" aria-hidden="true"></span> Payouts ledger
        <span class="popover" role="dialog" aria-label="Payouts ledger">
          <strong>Who got what, and why</strong>
          <ul>
            <li>A live record of how funds are split. You can see the total pot and the exact amount each verified parcel gets. Entries are time-stamped and can‚Äôt be edited.</li>
          </ul>
          <div class="tiny muted">Payouts calculated from its HealthScore</div>
        </span>
      </span>
    </div>
  </section>

  <!-- Slide 2 (reworked) -->
  <section class="screen panel with-bg" data-screen="2">
    <div class="step-count">2 / 5</div>

    <h2>Land joins & earns</h2>

   <div class="step-pills">
  <button class="step-tab" data-step="1">1&nbsp; Draw & Consent</button>
  <span class="sep"></span>
  <button class="step-tab" data-step="2">2&nbsp; Auto-check</button>
  <span class="sep"></span>
  <button class="step-tab" data-step="3">3&nbsp; Earn by HealthScore</button>
</div>



    

   <div class="step-viewport" id="landSteps">

  <div class="demo-step" data-step="1">
     <!-- Card 1: Draw & consent -->
      <article class="card2" aria-live="polite">
        <h3>Draw parcel boundary</h3>
        <div class="frame" id="frameDraw" role="img" aria-label="Map with drawn parcel boundary">
          <div class="map-grid"></div>
          <div class="boundary" id="boundaryDemo"></div>
          <div class="cursor" aria-hidden="true"></div>
        </div>
        <div class="row-mini">
          <span class="tag-mini" id="chipConsent">Consent needed</span>
          <span class="tag-mini" id="chipOwner">Ownership check</span>
        </div>
        <div class="row-mini">
          <button class="btn tiny primary" id="btnVerifyOwner">Verify ownership</button>
          <button class="btn tiny ghost" id="btnGiveConsent">Give consent</button>
        </div>
        <div class="caption">We only need a boundary and consent.</div>
      </article>

  </div>

  <div class="demo-step" data-step="2">
   <!-- Card 2: Automatic checks -->
      <article class="card2">
        <h3>Automatic checks</h3>
        <div class="frame" id="frameAuto" role="img" aria-label="Open satellite data split view">
          <div class="split">
            <div class="a"></div>
            <div class="b"></div>
          </div>
          <div class="status-badge ok" id="badgeStatus">Verified</div>
        </div>
        <div class="row-mini">
        
          <button class="btn tiny primary" id="btnToggleCheck">Toggle example</button>
          <span class="tag-mini">Open satellite data</span>
        </div>
        <div class="caption">Flagged cases go to an attestor for review.</div>
      </article>
  </div>

  <div class="demo-step" data-step="3">
      <!-- Card 3: Earn by HealthScore -->
      <article class="card2">
        <h3>Your share</h3>
        <div class="frame" id="frameGauge">
          <div class="gauge" id="gauge">
            <div class="small">HealthScore</div>
            <div class="big" id="scoreText">0.78</div>
            <div class="wallet" aria-hidden="true"></div>
          </div>
        </div>
        <div class="row-mini" aria-label="HealthScore slider">
          <input type="range" id="scoreSlider" min="0.4" max="0.95" step="0.01" value="0.78" />
          <span class="tag-mini">Earn share updates over time</span>
        </div>
        <div class="caption">Higher HealthScore ‚Üí larger share of payouts.</div>
      </article>

  </div>

</div>


     
      

    
    </div>

    <div class="nav"><button class="btn ghost" data-next="1">Back</button><button class="btn primary" data-next="3">Next: Funding</button></div>
  </section>




  
  <!-- Slide 3 -->
  <section class="screen panel with-bg" data-screen="3">
    <div class="step-count">3 / 5</div>

    <h2>Funding & certificates</h2>
    <p class="muted center">Companies buy Proof-of-Health certificates (retiring some ECO supply); people donate and receive a non-transferable Biome Badge.</p>

    <div class="cols">
      <article class="card">
        <h3>Companies</h3>
        <p class="muted tiny">Buy Proof-of-Health certificates</p>
        <div class="supply">
          <div class="bar"><span id="ecoBar"></span></div>
          <div class="muted tiny"><span id="ecoNum">1,000,000</span> ECO remaining</div>
        </div>
        <button class="btn primary" id="buyCert">Buy certificate</button>
        <div class="success hidden" id="certMsg">‚úÖ Certificate issued & 5,000 ECO retired.</div>
      </article>

      <article class="card">
        <h3>People</h3>
        <p class="muted tiny">Donate & receive a Biome Badge</p>
        <div class="badge">
          <img id="badgeImg" alt="Biome Badge" width="140" height="140"
               src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==" />
          <div class="muted tiny" id="badgeCap">No badge yet</div>
        </div>
        <div class="tiny muted">Badge level</div>
        <div class="scrub"><input type="range" id="badgeLevel" min="1" max="4" value="1" aria-label="Badge level"></div>
        <button class="btn primary" id="donateBtn">Donate ¬£10 (demo)</button>
        <div class="success hidden" id="donateMsg">‚úÖ Thanks! Biome Badge granted.</div>
      </article>
    </div>

    <div class="nav"><button class="btn ghost" data-next="2">Back</button><button class="btn primary" data-next="4">Next: Payouts</button></div>
  </section>

  <!-- Slide 4 -->
  <section class="screen panel with-bg" data-screen="4">
    <div class="step-count">4 / 5</div>

    <h2>Transparent, fair payouts</h2>
    <p class="muted center">Funds split automatically across verified parcels by HealthScore.</p>
    <div class="ledger" id="ledger"></div>
    <div class="nav"><button class="btn ghost" data-next="3">Back</button><button class="btn primary" data-next="5">Next: Trust</button></div>
  </section>

  <!-- Slide 5 -->
  <section class="screen panel with-bg" data-screen="5">
    <div class="step-count">5 / 5</div>

    <h2>Trust & governance</h2>
    <p class="muted center">Open registry, challenge & review, and on-chain governance keep the system fair.</p>

    <div class="cols">
      <article class="card">
        <h3>Open registry</h3>
        <p class="muted tiny">Every verified parcel is listed with its boundary, score and history.</p>
        <p class="muted tiny">Suspicious duplicates or big changes can be flagged and reviewed.</p>
      </article>

      <article class="card">
        <h3>Governed by holders</h3>
        <p class="muted tiny">Gaia Coin holders vote on parameters and rule updates.</p>
        <p class="muted tiny">Clear incentives and anti-gaming rules mean no one can profit from fraud.</p>
      </article>
    </div>

    <div class="nav"><button class="btn ghost" data-next="4">Back</button><button class="btn primary" data-next="1">Restart demo</button></div>
  </section>

</div>

<script>
(function(){
  const prefersReduced = window.matchMedia("(prefers-reduced-motion: reduce)").matches;

  // Router + progress + step count
  const screens=[...document.querySelectorAll(".screen")];
  const tabs=[...document.querySelectorAll(".stepper .tab")];
  const progressLine = document.getElementById("progressLine");
  const total= screens.length;

  const updateStepCount = (n)=>{
    document.querySelectorAll(".screen .step-count").forEach(el => { el.textContent = ""; });
    const el = document.querySelector(`.screen.active .step-count`);
    if(el) el.textContent = `${n} / ${total}`;
  };

  function show(n){
    screens.forEach(s=>s.classList.toggle("active",s.dataset.screen===String(n)));
    tabs.forEach(b=>b.classList.toggle("active",b.dataset.goto===String(n)));
    progressLine.style.width = ((n-1)/(total-1))*100 + "%";
    updateStepCount(n);
    postHeight();
    if(n===2) initSlide2();
    if(n===4) renderPayouts();
  }

  document.querySelectorAll("[data-next]").forEach(b=>b.addEventListener("click",()=>show(b.dataset.next)));
  tabs.forEach(b=>b.addEventListener("click",()=>show(b.dataset.goto)));
  document.addEventListener("keydown",(e)=>{
    const current = +screens.find(s=>s.classList.contains("active")).dataset.screen;
    if(e.key==="ArrowRight") show(Math.min(total,current+1));
    if(e.key==="ArrowLeft") show(Math.max(1,current-1));
  });
  show(1);

  // Hover popovers also open on tap for touch devices
  document.querySelectorAll('.hero .pill').forEach(pill=>{
    pill.addEventListener('click', (e)=>{
      if (window.matchMedia('(hover: none)').matches) {
        const wasOpen = pill.dataset.open === 'true';
        document.querySelectorAll('.pill[data-open="true"]').forEach(x=>delete x.dataset.open);
        if (!wasOpen) pill.dataset.open = 'true';
        e.stopPropagation();
      }
    });
    pill.addEventListener('keydown', (e)=>{ if (e.key === 'Escape') delete pill.dataset.open; });
  });
  document.addEventListener('click', (e)=>{
    if (!e.target.closest('.pill')) {
      document.querySelectorAll('.pill[data-open="true"]').forEach(x=>delete x.dataset.open);
    }
  });

  /* ===== Slide 2 interactions (new) ===== */
  let slide2Wired = false;
  function initSlide2(){
    if (slide2Wired) return;


// Tabs for slide 2
const tabs  = [...document.querySelectorAll('.step-tab')];
const steps = [...document.querySelectorAll('#landSteps .demo-step')];

function go(step){
  steps.forEach(s => s.classList.toggle('active', s.dataset.step == step));
  tabs.forEach(t => t.classList.toggle('active', t.dataset.step == step));
  postHeight();
}

tabs.forEach(t => t.addEventListener('click', ()=> go(t.dataset.step)));
go(1); // show the first view by default


    
    // Card 1: consent + ownership chips
    const chipConsent = document.getElementById('chipConsent');
    const chipOwner   = document.getElementById('chipOwner');
    const btnOwner    = document.getElementById('btnVerifyOwner');
    const btnConsent  = document.getElementById('btnGiveConsent');

    if (btnOwner) btnOwner.addEventListener('click', ()=>{
      chipOwner.textContent = 'Ownership verified';
      chipOwner.style.background = 'rgba(61,184,129,.22)';
      chipOwner.style.borderColor = 'rgba(61,184,129,.42)';
    });

    if (btnConsent) btnConsent.addEventListener('click', ()=>{
      chipConsent.textContent = 'Consent recorded';
      chipConsent.style.background = 'rgba(61,184,129,.22)';
      chipConsent.style.borderColor = 'rgba(61,184,129,.42)';
    });

    // Card 2: Verified ‚Üî Flagged ‚Üí Attestor
    const badge = document.getElementById('badgeStatus');
    const toggleBtn = document.getElementById('btnToggleCheck');
    if (toggleBtn) toggleBtn.addEventListener('click', ()=>{
      const flagged = badge.classList.toggle('flag');
      badge.classList.toggle('ok', !flagged);
      badge.textContent = flagged ? 'Flagged ‚Üí Attestor review' : 'Verified';
    });

    // Card 3: Gauge + coins
    const slider = document.getElementById('scoreSlider');
    const gauge  = document.getElementById('gauge');
    const scoreT = document.getElementById('scoreText');

    if (slider){
      const dropCoin = ()=>{
        const c = document.createElement('div');
        c.className = 'coin drop';
        c.style.left = (14 + 6 + Math.random()*20) + 'px';
        c.style.bottom = (42 + Math.random()*10) + 'px';
        gauge.appendChild(c);
        setTimeout(()=>c.remove(), 900);
      };

      const apply = ()=>{
        const v = parseFloat(slider.value);
        scoreT.textContent = v.toFixed(2);
        gauge.style.setProperty('--p', v);
        let n = Math.round(2 + (v - 0.4) * 10);
        for(let i=0;i<n;i++) setTimeout(dropCoin, i*60);
      };

      slider.addEventListener('input', apply);
      apply();
    }

    slide2Wired = true;
  }

  // Slide 3: funding (unchanged)
  let eco=1_000_000;
  const ecoBar=document.getElementById("ecoBar");
  const ecoNum=document.getElementById("ecoNum");
  const buyCert=document.getElementById("buyCert");
  const certMsg=document.getElementById("certMsg");
  const donateBtn=document.getElementById("donateBtn");
  const donateMsg=document.getElementById("donateMsg");
  const badgeImg=document.getElementById("badgeImg");
  const badgeCap=document.getElementById("badgeCap");
  const badgeLevel = document.getElementById("badgeLevel");

  function refreshEco(){ if(ecoNum){ ecoNum.textContent=eco.toLocaleString(); } if(ecoBar){ ecoBar.style.width=(eco/1_000_000*100)+"%"; } postHeight(); }
  refreshEco();

  if (buyCert) buyCert.addEventListener("click",()=>{
    eco=Math.max(0, eco-5000); refreshEco(); certMsg.classList.remove("hidden");
    if(!prefersReduced && ecoBar){ ecoBar.animate([{filter:'brightness(1.0)'},{filter:'brightness(1.3)'},{filter:'brightness(1.0)'}],{duration:600}); }
  });

  function badgeSVG(level){
    const titles={1:"L1 ‚Ä¢ Seed",2:"L2 ‚Ä¢ Sprout",3:"L3 ‚Ä¢ Bloom",4:"L4 ‚Ä¢ Wild"};
    const icons ={1:"üå±",2:"üåø",3:"ü¶ã",4:"üå≥"};
    const ring = level===1?12: level===2?16: level===3?20:24;
    const svg=`<svg xmlns='http://www.w3.org/2000/svg' width='520' height='520'>
      <defs><linearGradient id='g' x1='0' x2='1'><stop offset='0%' stop-color='#5cf0c2'/><stop offset='100%' stop-color='#786fff'/></linearGradient></defs>
      <rect width='100%' height='100%' fill='#0b0c10'/>
      <circle cx='260' cy='230' r='${120+level*6}' fill='none' stroke='url(#g)' stroke-width='${ring}' opacity='.35'/>
      <circle cx='260' cy='230' r='120' fill='none' stroke='url(#g)' stroke-width='12'/>
      <text x='260' y='230' font-size='76' text-anchor='middle' dominant-baseline='middle'>${icons[level]}</text>
      <text x='260' y='390' font-family='Plus Jakarta Sans, Arial' font-size='22' text-anchor='middle' fill='#cfe9da'>Biome Badge ‚Äî ${titles[level]}</text>
    </svg>`;
    return "data:image/svg+xml;utf8,"+encodeURIComponent(svg);
  }

  if (badgeLevel) badgeLevel.addEventListener("input", ()=>{
    const lvl = +badgeLevel.value;
    if (badgeImg) badgeImg.src = badgeSVG(lvl);
    if (badgeCap) badgeCap.textContent = "Biome Badge ‚Äî Level " + lvl;
    postHeight();
  });

  if (donateBtn) donateBtn.addEventListener("click",()=>{
    donateBtn.disabled=true;
    if (badgeImg) badgeImg.src=badgeSVG(+badgeLevel.value || 1);
    if (badgeCap) badgeCap.textContent="Biome Badge ‚Äî Level " + (+badgeLevel.value || 1);
    donateMsg.classList.remove("hidden");
    postHeight();
  });

  // Slide 4: payouts (self-contained sample)
  const ledger=document.getElementById("ledger");
  function renderPayouts(){
    if(!ledger) return;
    ledger.innerHTML="";

    // sample data
    const names=["Andes Reserve","Coastal Wetland","Prairie Meadow","Alpine Valley","Rice Terrace","Cloud Forest","Dune Heath","Peat Bog"];
    const biomes=["Rainforest","Wetland","Grassland","Montane","Agro-ecosystem","Savanna","Woodland","Coastal"];
    const rand=(a,b)=>+(a+Math.random()*(b-a)).toFixed(2);

    const sample = names.map((n,i)=>({ name:n, biome:biomes[i%biomes.length], score:rand(0.62,0.93) }));
    const pot=2000;
    const total=sample.reduce((a,c)=>a+c.score,0);

    sample.forEach(p=>{
      const share=p.score/total;
      const amt=+(pot*share).toFixed(2);
      const row=document.createElement('div');
      row.className='row';
      row.innerHTML = `
        <div><strong>${p.name}</strong> <span class="muted">(${p.biome})</span></div>
        <div class="bar"><span style="width:0%"></span></div>
        <div>¬£<b>${amt.toLocaleString()}</b></div>`;
      ledger.appendChild(row);
      setTimeout(()=>{row.querySelector(".bar span").style.width=Math.min(100, share*100*2)+"%";}, 40);
    });

    if(!prefersReduced){
      for(let i=0;i<10;i++){
        const c=document.createElement("div"); c.className="flow";
        ledger.appendChild(c);
        const y = 20 + Math.random()* (sample.length*48);
        const duration = 1200 + Math.random()*1200;
        c.style.top = y+"px"; c.style.opacity = "1";
        c.animate([{transform:"translateX(0px)",opacity:1},{transform:"translateX(960px)",opacity:.2}],{duration,iterations:1,easing:"ease-out",fill:"forwards"});
        setTimeout(()=>c.remove(), duration+100);
      }
    }
    postHeight();
  }

  // iframe auto-height for Shopify embed
  const postHeight = () => {
    const h = document.documentElement.scrollHeight;
    parent.postMessage({ type:"gaia-demo-height", height:h }, "*");
  };
  const mo = new MutationObserver(postHeight);
  mo.observe(document.body,{childList:true,subtree:true,attributes:true});
  window.addEventListener("load",postHeight);
  window.addEventListener("resize",postHeight);
})();
</script>
</body>
</html>
