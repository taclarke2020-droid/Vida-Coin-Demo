<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gaia Demo</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>

  /* === GAIA Lake Hero (SVG) === */
.hero.hero--gaia{ 
  position:relative; 
  border-radius:28px; 
  padding:110px 20px 74px; 
  background:#07161a; 
  text-align:center; 
  isolation:isolate; 
  box-shadow:0 14px 44px rgba(0,0,0,.38); 
  overflow:hidden;
}
/* kill the old gradient hills when this variant is used */
.hero.hero--gaia::before,
.hero.hero--gaia::after{ content:none !important; }

.hero--gaia .hero-bg{ position:absolute; inset:0; z-index:-1; pointer-events:none; }
.hero--gaia .hero-bg svg{ width:100%; height:100%; display:block; }

/* heading + chip spacing (keeps your existing tokens) */
.hero--gaia h1{ font-size:clamp(34px,5.4vw,60px); line-height:1.04; margin:0 0 18px; font-weight:800; }
.hero--gaia .chip{ display:inline-block; margin:6px 0 12px; padding:6px 14px; border-radius:999px;
  color:#cfeee0; background:rgba(114,206,155,.14); border:1px solid rgba(114,206,155,.22); font-weight:800; letter-spacing:.02em; }
.hero--gaia .lead{ max-width:880px; margin:12px auto 8px; color:#d9efe4; font-size:1.08rem; line-height:1.7; }
.hero--gaia .sub{ max-width:880px; margin:8px auto 24px; color:#a7cdb5; }

/* tiny ambient motion */
.hero--gaia .bird{ animation:gaia-bird 18s ease-in-out infinite; opacity:.7 }
.hero--gaia .bird.b2{ animation-duration:22s; opacity:.55 }
@keyframes gaia-bird{ 0%{ transform:translateX(-3%)} 50%{ transform:translateY(-6px)} 100%{ transform:translateX(3%)} }

/* soft twinkle for stars */
.hero--gaia .sparkle{ animation:gaia-star 4s ease-in-out infinite; transform-origin:center; }
@keyframes gaia-star{ 0%,100%{ opacity:.25; transform:scale(1) } 50%{ opacity:.65; transform:scale(1.2) } }

:root{
  /* Forest Regeneration palette */
  --bg:#07130a; --panel:#0b1a0f; --ink:#eef7f0; --muted:#a6cdb3; --edge:rgba(255,255,255,.07);
  --brand:#4cc26f; --brand2:#2aa38f;
  --chipbg:rgba(114,206,155,.14); --chipbr:rgba(114,206,155,.22);
  --ring:rgba(76,194,111,.18);
}

*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--ink);font-family:"Plus Jakarta Sans",system-ui,Arial,sans-serif}

/* layout */
.wrap{max-width:1200px;margin:0 auto;padding:16px}
.screen{display:none;opacity:0;transform:translateY(8px);transition:opacity .35s,transform .35s}
.screen.active{display:block;opacity:1;transform:none}

/* === Sticky stepper with progress === */
.sticky{position:sticky;top:0;z-index:40;background:linear-gradient(180deg,rgba(7,19,10,.86),rgba(7,19,10,.48));backdrop-filter:blur(8px);border-bottom:1px solid var(--edge)}
.stepper{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;padding:10px}
.stepper button{background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03));border:1px solid var(--edge);border-radius:999px;color:var(--ink);font-weight:700;font-size:.86rem;padding:.5rem .8rem;cursor:pointer}
.stepper button.active{border-color:rgba(114,206,155,.5);box-shadow:0 0 0 2px rgba(114,206,155,.22) inset}
.progress{height:3px;background:var(--edge);border-radius:999px;overflow:hidden;margin:0 16px 8px}
.progress span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--brand),var(--brand2))}

/* === Hero container === */
.hero{
  position:relative;border-radius:28px;padding:110px 20px 74px;background:#09170e;text-align:center;
  isolation:isolate;box-shadow:0 14px 44px rgba(0,0,0,.38);overflow:hidden
}

/* Illustrated SVG background (shows behind content) */
.hero-art{position:absolute; inset:0; z-index:0; overflow:hidden; pointer-events:none}
.hero > *:not(.hero-art){ position:relative; z-index:1 } /* keep text/buttons above the art */
.hero-art svg{ width:100%; height:100%; display:block }

/* tiny ambient motion */
@keyframes bird-fly { 0%{transform:translateX(-3%)} 50%{transform:translateY(-6px)} 100%{transform:translateX(3%)} }
.hero-art .bird{animation:bird-fly 18s ease-in-out infinite; opacity:.7}
.hero-art .bird.b2{animation-duration:22s; opacity:.55}
@media (prefers-reduced-motion:reduce){ .hero-art .bird{animation:none} }

/* OPTIONAL glow elements */
.aura,.aura::after{
  content:"";position:absolute;inset:-25%;
  background:
    radial-gradient(60% 40% at 25% 20%,rgba(76,194,111,.16),transparent 60%),
    radial-gradient(60% 40% at 80% 70%,rgba(40,154,133,.16),transparent 60%),
    conic-gradient(from 240deg at 50% 50%,rgba(76,194,111,.18),rgba(40,154,133,.18),rgba(76,194,111,.12));
  filter:blur(42px);z-index:1;opacity:.85
}
.pulse{position:absolute;inset:auto auto -60px 50%;transform:translateX(-50%);width:540px;height:540px;border-radius:50%;box-shadow:0 0 0 0 var(--ring);animation:pulse 3.8s ease-out infinite;pointer-events:none;z-index:1}
@keyframes pulse{0%{box-shadow:0 0 0 0 var(--ring)}100%{box-shadow:0 0 0 190px rgba(76,194,111,0)}}
@media (prefers-reduced-motion:reduce){ .aura,.aura::after,.pulse{animation:none} }

h1{font-size:clamp(34px,5.4vw,60px);line-height:1.04;margin:0 0 18px;font-weight:800;letter-spacing:.005em}
.chip{display:inline-block;margin:6px 0 12px;padding:6px 14px;border-radius:999px;color:#b3f2cd;background:var(--chipbg);border:1px solid var(--chipbr);font-weight:800;letter-spacing:.02em}
.lead{max-width:880px;margin:12px auto 8px;color:#d9efe4;font-size:1.08rem;line-height:1.7}
.sub{max-width:880px;margin:8px auto 24px;color:#a7cdb5}

/* Buttons */
.btn{border-radius:14px;font-weight:800;cursor:pointer;padding:.95rem 1.28rem;border:1px solid transparent}
.btn.primary{background:linear-gradient(180deg,#7fe09f,#3abf97);color:#05140c;border:0;box-shadow:0 12px 30px rgba(58,191,151,.32);transition:transform .12s ease,filter .12s ease,box-shadow .12s ease}
.btn.primary:hover{transform:translateY(-1px);filter:brightness(1.05);box-shadow:0 16px 38px rgba(58,191,151,.44)}
.btn.ghost{background:rgba(255,255,255,.03);color:#d9efe4;border-color:var(--edge);backdrop-filter:blur(2px)}
.cta{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
.pills{display:flex;gap:14px;justify-content:center;flex-wrap:wrap;margin-top:26px;color:#a7cdb5}
.pills span{padding:6px 10px;border:1px solid var(--edge);border-radius:999px}

/* Panels */
.panel{background:linear-gradient(180deg,#0b1a0f,#0b1a0f);border-radius:28px;padding:32px 16px 26px;box-shadow:0 12px 40px rgba(0,0,0,.35)}
h2{margin:4px 0 14px;text-align:center;font-size:clamp(24px,3.6vw,36px)}
.center{text-align:center}.muted{color:var(--muted)} .tiny{font-size:.92rem}

/* Timeline */
.rail{display:flex;align-items:center;justify-content:center;gap:10px;margin:10px 0 18px}
.rail .line{width:48px;height:2px;background:var(--edge)}
.dot{display:grid;place-items:center;width:28px;height:28px;border-radius:999px;border:1px solid var(--edge);background:rgba(255,255,255,.03);font-weight:700}

/* Parcel grid */
.grid{--min:260px;display:grid;grid-template-columns:repeat(auto-fit,minmax(var(--min),1fr));gap:12px;max-width:1060px;margin:0 auto 10px}
.card{padding:14px 12px;border-radius:14px;background:rgba(255,255,255,.03);border:1px solid var(--edge);backdrop-filter:blur(4px)}
.card .top{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.tag{font-size:.75rem;border:1px solid var(--edge);border-radius:999px;padding:2px 8px;color:#d9efe4}
.prog{height:8px;border-radius:999px;background:rgba(255,255,255,.06);overflow:hidden;margin-top:6px}
.prog span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--brand),var(--brand2));transition:width .7s ease}
.meta{margin-top:6px;color:var(--muted);font-size:.95rem}

/* KPIs */
.kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;max-width:1060px;margin:12px auto 6px}
.kpi{background:rgba(255,255,255,.03);border:1px solid var(--edge);border-radius:14px;padding:12px;text-align:center}
.kpi .label{color:var(--muted);font-size:.9rem}
.kpi .value{font-weight:800;font-size:1.4rem;margin-top:4px}

/* Scrubber */
.scrub{display:flex;align-items:center;gap:10px;justify-content:center;margin:8px 0 2px}
input[type="range"]{width:280px}

/* Funding columns */
.cols{display:grid;grid-template-columns:1fr 1fr;gap:12px;max-width:1060px;margin:8px auto}
@media (max-width:860px){.cols{grid-template-columns:1fr}}
.card h3{margin:4px 0 6px}

/* ECO supply + badge */
.supply .bar{height:10px;border-radius:999px;background:rgba(255,255,255,.06);overflow:hidden;margin:6px 0}
.supply .bar span{display:block;height:100%;width:100%;background:linear-gradient(90deg,var(--brand),var(--brand2))}
.success{margin-top:8px;color:#b3f2cd}.hidden{display:none}
.badge{display:flex;gap:12px;align-items:center;margin:6px 0 12px}
.badge img{border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,.3)}

/* Payout ledger + coin flow */
.ledger{position:relative;max-width:1060px;margin:10px auto 8px;border-radius:16px;padding:8px}
.row{display:grid;grid-template-columns:2fr 1fr 1fr;gap:12px;align-items:center;padding:10px 12px;border-bottom:1px solid var(--edge)}
.row:last-child{border-bottom:0}
.bar{height:10px;border-radius:999px;background:rgba(255,255,255,.06);overflow:hidden}
.bar span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--brand),var(--brand2));transition:width .8s ease}
.flow{position:absolute;left:18px;top:-16px;height:16px;width:16px;border-radius:50%;background:linear-gradient(180deg,#7fe09f,#3abf97);box-shadow:0 0 12px rgba(58,191,151,.6);opacity:0;pointer-events:none}
.nav{display:flex;justify-content:space-between;gap:10px;max-width:1060px;margin:12px auto 0}

/* === Use your uploaded image as the Slide 1 background === */
.hero{
  /* leave your existing padding/radius etc. */
  background:
    #09170e
    url("background.png")         /* your file at the same level as index.html */
    center / cover no-repeat;
  min-height: clamp(520px, 70vh, 760px);
}

/* turn OFF any old gradient/illustration layers on the hero */
.hero::before{ content:none !important; }

/* soft glow + vignette so text is readable on top of the art */
.hero::after{
  content:"";
  position:absolute; inset:0; z-index:0;
  background:
    radial-gradient(1200px 560px at 64% 8%, rgba(255,230,150,.16), transparent 60%),
    linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,.28) 55%, rgba(0,0,0,.55) 100%);
}

/* keep your headings/buttons above the overlay */
.hero > *{ position:relative; z-index:1; }

  
</style>



  
</head>
<body>
<div class="sticky">
  <div class="stepper" aria-label="Demo steps">
    <button class="tab active" data-goto="1">Intro</button>
    <button class="tab" data-goto="2">Land joins</button>
    <button class="tab" data-goto="3">Funding</button>
    <button class="tab" data-goto="4">Payouts</button>
  </div>
  <div class="progress"><span id="progressLine"></span></div>
</div>

<div class="wrap">

  <!-- Slide 1 -->
  <section class="screen hero hero--gaia active" data-screen="1" aria-live="polite">
  <!-- Illustrated background (no external assets) -->
  <div class="hero-bg" aria-hidden="true">
    <svg viewBox="0 0 1600 700" preserveAspectRatio="xMidYMid slice" role="img">
      <defs>
        <!-- sky & dawn -->
        <linearGradient id="skyG" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%"  stop-color="#0a2024"/>
          <stop offset="60%" stop-color="#0a2b29"/>
          <stop offset="100%" stop-color="#0a1a15"/>
        </linearGradient>
        <radialGradient id="sunG" cx="60%" cy="-12%" r="48%">
          <stop offset="0%" stop-color="rgba(255,230,150,.30)"/>
          <stop offset="100%" stop-color="rgba(255,230,150,0)"/>
        </radialGradient>

        <!-- ridges & water -->
        <linearGradient id="ridgeFar" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%"  stop-color="#143b3e"/><stop offset="100%" stop-color="#0f2c2e"/>
        </linearGradient>
        <linearGradient id="ridgeNear" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%"  stop-color="#175047"/><stop offset="100%" stop-color="#123c33"/>
        </linearGradient>
        <linearGradient id="lakeG" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%"  stop-color="#2aa38f" stop-opacity=".45"/>
          <stop offset="100%" stop-color="#1a6c59" stop-opacity=".6"/>
        </linearGradient>

        <!-- simple evergreen -->
        <g id="tree">
          <polygon points="0,-34 10,-18 -10,-18" fill="#1b5e4c"/>
          <polygon points="0,-20 14,0 -14,0" fill="#1f674f"/>
          <rect x="-2" y="0" width="4" height="12" rx="1.5" fill="#134137"/>
        </g>

        <!-- soft top fade so text always pops -->
        <linearGradient id="fadeG" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stop-color="white" stop-opacity="0"/>
          <stop offset="28%" stop-color="white" stop-opacity=".22"/>
          <stop offset="62%" stop-color="white" stop-opacity=".9"/>
          <stop offset="100%" stop-color="white" stop-opacity="1"/>
        </linearGradient>
        <mask id="fadeMask"><rect width="1600" height="700" fill="url(#fadeG)"/></mask>

        <!-- gentle film grain -->
        <filter id="grain" x="-20%" y="-20%" width="140%" height="140%">
          <feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="2" seed="7" result="n"/>
          <feColorMatrix type="saturate" values="0"/>
          <feComponentTransfer><feFuncA type="table" tableValues="0 0 .03 .05 .04 0"/></feComponentTransfer>
          <feBlend in="SourceGraphic" in2="n" mode="overlay"/>
        </filter>
      </defs>

      <!-- sky & dawn -->
      <rect width="1600" height="700" fill="url(#skyG)"/>
      <circle cx="980" cy="-20" r="420" fill="url(#sunG)"/>

      <!-- distant & near mountain ridges -->
      <g filter="url(#grain)">
        <path d="M0,420 Q360,320 760,380 T1600,350 L1600,700 L0,700 Z" fill="url(#ridgeFar)" opacity=".9"/>
        <path d="M0,510 Q360,430 820,500 T1600,470 L1600,700 L0,700 Z" fill="url(#ridgeNear)"/>
      </g>

      <!-- tree line -->
      <g opacity=".85" filter="url(#grain)">
        <use href="#tree" transform="translate(120,520) scale(1.1)"/>
        <use href="#tree" transform="translate(220,512) scale(1.05)"/>
        <use href="#tree" transform="translate(360,516) scale(1.2)"/>
        <use href="#tree" transform="translate(520,520) scale(1.1)"/>
        <use href="#tree" transform="translate(690,514) scale(1.15)"/>
        <use href="#tree" transform="translate(860,520) scale(1.05)"/>
        <use href="#tree" transform="translate(1040,516) scale(1.2)"/>
        <use href="#tree" transform="translate(1200,524) scale(1.1)"/>
        <use href="#tree" transform="translate(1380,510) scale(1.2)"/>
      </g>

      <!-- lake reflection -->
      <path d="M0,600 Q420,560 900,600 T1600,570 L1600,700 L0,700 Z" fill="url(#lakeG)" opacity=".75"/>

      <!-- birds + stars -->
      <g class="bird" stroke="#e3f6ee" stroke-width="2" stroke-linecap="round" fill="none" opacity=".7">
        <path d="M-30,150 q16,-12 32,0 q16,-12 32,0"/>
      </g>
      <g class="bird b2" stroke="#e3f6ee" stroke-width="2" stroke-linecap="round" fill="none" opacity=".55">
        <path d="M1040,110 q16,-12 32,0 q16,-12 32,0"/>
      </g>

      <g fill="#d7f0e6" opacity=".7">
        <circle class="sparkle" cx="260" cy="120" r="1.6"/>
        <circle class="sparkle" cx="300" cy="140" r="1.4"/>
        <circle class="sparkle" cx="1280" cy="130" r="1.5"/>
        <circle class="sparkle" cx="1120" cy="90" r="1.3"/>
      </g>

      <!-- top fade for legibility -->
      <rect width="1600" height="700" fill="#000" mask="url(#fadeMask)" opacity=".25"/>
    </svg>
  </div>

  <h1>When nature improves, Gaia pays you.</h1>
  <div class="chip">What is Gaia?</div>

  <p class="lead">
    Gaia is a decentralised crypto system that automatically rewards verified land stewards for restoring and maintaining healthy ecosystems â€” funded by companies and donors who want real, measurable impact.
  </p>
  <p class="sub">
    The system is powered by Gaia Coin â€” a crypto currency which rewards ecological care twice, through fair governance and rising value as global ecosystems recover.
  </p>

  <div class="cta">
    <button class="btn primary" data-next="2">Start the demo</button>
    <button class="btn ghost" data-next="2">See how it works</button>
  </div>

  <div class="pills">
    <span>Open satellite data</span>
    <span>Auditable registry</span>
    <span>Transparent payouts</span>
  </div>
</section>


  <!-- Slide 2 -->
  <section class="screen panel" data-screen="2">
    <h2>Land joins & earns</h2>
    <p class="muted center">Privately owned or charity land onboards, gets verified, receives a HealthScore, then earns Gaia Coins over time.</p>
    <div class="rail"><div class="dot">1</div>Sign up<div class="line"></div><div class="dot">2</div>Verify<div class="line"></div><div class="dot">3</div>HealthScore<div class="line"></div><div class="dot">4</div>Earn</div>

    <div class="scrub">
      <span class="tiny muted">Faster</span>
      <input type="range" id="speed" min="0" max="100" value="40" aria-label="Onboarding speed">
      <span class="tiny muted">Slower</span>
    </div>

    <div class="grid" id="grid"></div>

    <div class="kpis">
      <div class="kpi"><div class="label">Parcels onboarded</div><div class="value" id="mParcels">0</div></div>
      <div class="kpi"><div class="label">Avg HealthScore</div><div class="value" id="mAvg">â€”</div></div>
      <div class="kpi"><div class="label">Gaia earned (demo)</div><div class="value" id="mCoins">0</div></div>
    </div>

    <div class="nav"><button class="btn ghost" data-next="1">Back</button><button class="btn primary" data-next="3">Next: Funding</button></div>
  </section>

  <!-- Slide 3 -->
  <section class="screen panel" data-screen="3">
    <h2>Funding & certificates</h2>
    <p class="muted center">Companies buy Proof-of-Health certificates (retiring some ECO supply); people donate and receive a non-transferable Biome Badge.</p>

    <div class="cols">
      <article class="card">
        <h3>Companies</h3>
        <p class="muted tiny">Buy Proof-of-Health certificates</p>
        <div class="supply">
          <div class="bar"><span id="ecoBar"></span></div>
          <div class="muted tiny"><span id="ecoNum">1,000,000</span> ECO remaining</div>
        </div>
        <button class="btn primary" id="buyCert">Buy certificate</button>
        <div class="success hidden" id="certMsg">âœ… Certificate issued & 5,000 ECO retired.</div>
      </article>

      <article class="card">
        <h3>People</h3>
        <p class="muted tiny">Donate & receive a Biome Badge</p>
        <div class="badge">
          <img id="badgeImg" alt="Biome Badge" width="140" height="140"
               src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==" />
          <div class="muted tiny" id="badgeCap">No badge yet</div>
        </div>
        <div class="tiny muted">Badge level</div>
        <div class="scrub"><input type="range" id="badgeLevel" min="1" max="4" value="1" aria-label="Badge level"></div>
        <button class="btn primary" id="donateBtn">Donate Â£10 (demo)</button>
        <div class="success hidden" id="donateMsg">âœ… Thanks! Biome Badge granted.</div>
      </article>
    </div>

    <div class="nav"><button class="btn ghost" data-next="2">Back</button><button class="btn primary" data-next="4">Next: Payouts</button></div>
  </section>

  <!-- Slide 4 -->
  <section class="screen panel" data-screen="4">
    <h2>Transparent, fair payouts</h2>
    <p class="muted center">Funds split automatically across verified parcels by HealthScore.</p>
    <div class="ledger" id="ledger"></div>
    <div class="nav"><button class="btn ghost" data-next="3">Back</button><button class="btn primary" data-next="1">Restart demo</button></div>
  </section>

</div>

<script>
(function(){
  const prefersReduced = window.matchMedia("(prefers-reduced-motion: reduce)").matches;

  // Router + progress
  const screens=[...document.querySelectorAll(".screen")];
  const tabs=[...document.querySelectorAll(".stepper .tab")];
  const progressLine = document.getElementById("progressLine");
  const total= screens.length;
  const show=n=>{
    screens.forEach(s=>s.classList.toggle("active",s.dataset.screen===String(n)));
    tabs.forEach(b=>b.classList.toggle("active",b.dataset.goto===String(n)));
    progressLine.style.width = ((n-1)/(total-1))*100 + "%";
    postHeight();
    if(n===2) startOnboarding();
    if(n===4) renderPayouts();
  };
  document.querySelectorAll("[data-next]").forEach(b=>b.addEventListener("click",()=>show(b.dataset.next)));
  tabs.forEach(b=>b.addEventListener("click",()=>show(b.dataset.goto)));
  document.addEventListener("keydown",(e)=>{
    const current = +screens.find(s=>s.classList.contains("active")).dataset.screen;
    if(e.key==="ArrowRight") show(Math.min(total,current+1));
    if(e.key==="ArrowLeft") show(Math.max(1,current-1));
  });
  show(1);

  // Slide 2: land joins
  const grid=document.getElementById("grid");
  const mParcels=document.getElementById("mParcels");
  const mAvg=document.getElementById("mAvg");
  const mCoins=document.getElementById("mCoins");
  const names=["Andes Reserve","Coastal Wetland","Prairie Meadow","Alpine Valley","Rice Terrace","Cloud Forest","Dune Heath","Peat Bog"];
  const codes=["PE","KE","US","CH","VN","CO","UK","IE"];
  const biomes=["Rainforest","Wetland","Grassland","Montane","Agro-ecosystem","Savanna","Woodland","Coastal"];
  const parcels=[];
  const rand=(a,b)=>+(a+Math.random()*(b-a)).toFixed(2);
  const el=h=>{const d=document.createElement("div"); d.innerHTML=h.trim(); return d.firstElementChild};
  let timer=null;

  function addParcel(){
    const i=parcels.length%8;
    const score=rand(0.62,0.93);
    const earned=+(score*100).toFixed(2);
    const p={name:names[i],code:codes[i],biome:biomes[Math.floor(Math.random()*biomes.length)],score,earned};
    parcels.push(p);
    const card=el(`
      <article class="card" aria-live="polite">
        <div class="top">
          <strong>${p.name} <span class="muted">(${p.code})</span></strong>
          <span class="tag">${p.biome}</span>
        </div>
        <div class="meta">Sign up â€¢ Verify â€¢ Score â€¢ Earn</div>
        <div class="prog" role="progressbar" aria-valuemin="0" aria-valuemax="100"><span></span></div>
        <div class="meta"><span>HealthScore: <b>${p.score}</b></span> Â· <span>Earned: <b>Â£${p.earned}</b></span></div>
      </article>
    `);
    grid.appendChild(card);
    setTimeout(()=>{card.querySelector(".prog span").style.width=Math.min(100,p.score*100)+"%"; postHeight();}, 40);

    mParcels.textContent=parcels.length;
    const avg=parcels.reduce((a,c)=>a+c.score,0)/parcels.length;
    mAvg.textContent=avg?avg.toFixed(2):"â€”";
    mCoins.textContent=Math.round(parcels.reduce((a,c)=>a+c.earned,0)).toLocaleString();
  }

  const speed = document.getElementById("speed");
  function startOnboarding(){
    if(timer) return;
    if(parcels.length===0){for(let i=0;i<4;i++) addParcel();}
    timer=setInterval(()=>{ if(parcels.length>=14){clearInterval(timer); timer=null; return;} addParcel(); }, getInterval());
  }
  function getInterval(){
    // slider: 0..100 â†’ 200..1400ms
    const v = +speed.value;
    return 200 + (100-v)*12;
  }
  speed.addEventListener("input", ()=>{
    if(timer){ clearInterval(timer); timer=setInterval(()=>{ if(parcels.length>=14){clearInterval(timer); timer=null; return;} addParcel(); }, getInterval()); }
  });

  // Slide 3: funding
  let eco=1_000_000;
  const ecoBar=document.getElementById("ecoBar");
  const ecoNum=document.getElementById("ecoNum");
  const buyCert=document.getElementById("buyCert");
  const certMsg=document.getElementById("certMsg");
  const donateBtn=document.getElementById("donateBtn");
  const donateMsg=document.getElementById("donateMsg");
  const badgeImg=document.getElementById("badgeImg");
  const badgeCap=document.getElementById("badgeCap");
  const badgeLevel = document.getElementById("badgeLevel");

  function refreshEco(){ ecoNum.textContent=eco.toLocaleString(); ecoBar.style.width=(eco/1_000_000*100)+"%"; postHeight(); }
  refreshEco();

  buyCert.addEventListener("click",()=>{
    eco=Math.max(0, eco-5000); refreshEco(); certMsg.classList.remove("hidden");
    if(!prefersReduced){ ecoBar.animate([{filter:'brightness(1.0)'},{filter:'brightness(1.3)'},{filter:'brightness(1.0)'}],{duration:600}); }
  });

  function badgeSVG(level){
    const titles={1:"L1 â€¢ Seed",2:"L2 â€¢ Sprout",3:"L3 â€¢ Bloom",4:"L4 â€¢ Wild"};
    const icons ={1:"ðŸŒ±",2:"ðŸŒ¿",3:"ðŸ¦‹",4:"ðŸŒ³"};
    const ring = level===1?12: level===2?16: level===3?20:24;
    const svg=`<svg xmlns='http://www.w3.org/2000/svg' width='520' height='520'>
      <defs><linearGradient id='g' x1='0' x2='1'><stop offset='0%' stop-color='#5cf0c2'/><stop offset='100%' stop-color='#786fff'/></linearGradient></defs>
      <rect width='100%' height='100%' fill='#0b0c10'/>
      <circle cx='260' cy='230' r='${120+level*6}' fill='none' stroke='url(#g)' stroke-width='${ring}' opacity='.35'/>
      <circle cx='260' cy='230' r='120' fill='none' stroke='url(#g)' stroke-width='12'/>
      <text x='260' y='230' font-size='76' text-anchor='middle' dominant-baseline='middle'>${icons[level]}</text>
      <text x='260' y='390' font-family='Plus Jakarta Sans, Arial' font-size='22' text-anchor='middle' fill='#cfe9da'>Biome Badge â€” ${titles[level]}</text>
    </svg>`;
    return "data:image/svg+xml;utf8,"+encodeURIComponent(svg);
  }

  badgeLevel.addEventListener("input", ()=>{
    const lvl = +badgeLevel.value;
    badgeImg.src = badgeSVG(lvl);
    badgeCap.textContent = "Biome Badge â€” Level " + lvl;
    postHeight();
  });

  donateBtn.addEventListener("click",()=>{
    donateBtn.disabled=true;
    badgeImg.src=badgeSVG(+badgeLevel.value || 1);
    badgeCap.textContent="Biome Badge â€” Level " + (+badgeLevel.value || 1);
    donateMsg.classList.remove("hidden");
    postHeight();
  });

  // Slide 4: payouts (with coin flow)
  const ledger=document.getElementById("ledger");
  function renderPayouts(){
    ledger.innerHTML="";
    if(parcels.length===0){for(let i=0;i<6;i++) addParcel();}
    const sample=parcels.slice(0,8);
    const pot=2000;
    const total=sample.reduce((a,c)=>a+c.score,0);
    sample.forEach(p=>{
      const share=p.score/total;
      const amt=+(pot*share).toFixed(2);
      const row=el(`<div class="row">
        <div><strong>${p.name}</strong> <span class="muted">(${p.biome})</span></div>
        <div class="bar"><span style="width:0%"></span></div>
        <div>Â£<b>${amt.toLocaleString()}</b></div>
      </div>`);
      ledger.appendChild(row);
      setTimeout(()=>{row.querySelector(".bar span").style.width=Math.min(100, share*100*2)+"%";}, 40);
    });

    if(!prefersReduced){
      // glowing dots flowing across rows
      for(let i=0;i<10;i++){
        const c=document.createElement("div"); c.className="flow";
        ledger.appendChild(c);
        const rowCount = sample.length;
        const y = 20 + Math.random()* (rowCount*48);
        const duration = 1200 + Math.random()*1200;
        c.style.top = y+"px"; c.style.opacity = "1";
        c.animate([{transform:"translateX(0px)",opacity:1},{transform:"translateX(960px)",opacity:.2}],{duration,iterations:1,easing:"ease-out",fill:"forwards"});
        setTimeout(()=>c.remove(), duration+100);
      }
    }
    postHeight();
  }

  // iframe auto-height for Shopify embed
  const postHeight = () => {
    const h = document.documentElement.scrollHeight;
    parent.postMessage({ type:"gaia-demo-height", height:h }, "*");
  };
  const mo = new MutationObserver(postHeight);
  mo.observe(document.body,{childList:true,subtree:true,attributes:true});
  window.addEventListener("load",postHeight);
  window.addEventListener("resize",postHeight);
})();
</script>
</body>
</html>
