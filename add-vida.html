<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Add VIDA to MetaMask</title>
  <style>
    :root{
      --bg:#0b1c14; --card:#10261c; --text:#d9f7e8; --muted:#bfead6; --warn:#ffd38a; --accent:#39c18f;
    }
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      display:flex; align-items:center; justify-content:center;
    }
    .wrap{width:min(720px,92%); text-align:center}
    .card{
      background:var(--card); border-radius:16px; box-shadow:0 8px 24px rgba(0,0,0,.25);
      padding:28px 24px;
    }
    h1{margin:0 0 10px; font-size:36px; line-height:1.1}
    p{margin:8px 0; color:var(--muted)}
    .warn{color:var(--warn)}
    code{background:#0e1f17; border:1px solid #214734; border-radius:6px; padding:2px 6px}
    .manual{
      display:none; margin-top:16px; text-align:left;
      padding:16px 18px; border:1px solid #254837; border-radius:12px;
    }
    ol{margin:6px 0 0 18px; line-height:1.55}
  </style>
</head>
<body>
  <main class="wrap">
    <section class="card">
      <h1>Adding <span style="color:#7DE3B1">VIDA</span> to MetaMask…</h1>
      <p id="status">Please wait while we connect and add the token.</p>

      <!-- Manual fallback (shown only if auto-add fails) -->
 <div style="display:flex; justify-content:center; text-align:left; margin-top:20px;">
  <div id="manual" style="display:none; max-width:420px; background:#10261c; border:1px solid #254837; border-radius:10px; padding:16px 20px;">
    <p style="text-align:center; font-weight:bold; color:#9ff0c9;">Manually add VIDA to MetaMask (mobile):</p>
    <ol style="margin:0; padding-left:20px; color:#dff6e8; line-height:1.5;">
    <li>Open MetaMask and click the small + icon on the right of the screen.</li>
    <li>Select "Custom"</li>
    <li>Choose <b>Base</b> from the "Select a network" drop-down menu.</li>
    <li>Paste this <code>0x1D929E2422AEC567907f7fE2B966f7f84CA1858F</code> under "Token contract address".</li>
    <li>Select next.</li>
    <li>Press import.</li>
  </ol>
</div>
<p id="msg" style="display:none;margin-top:8px;opacity:.85;"></p>
    </section>
  </main>

  <script>
  // ---- Config ----
  const TOKEN = {
    address: '0x1D929E2422AEC567907f7fE2B966f7f84CA1858F',
    symbol:  'VIDA',
    decimals: 18,
    // Prefer a small HTTPS PNG if available:
    image:   'https://rawcdn.githack.com/taclarke2020-droid/Vida-Coin-Demo/refs/heads/main/Vida%20coin%20logo.svg'
  };
  const BASE = {
    chainId: '0x2105', // 8453
    chainName: 'Base',
    nativeCurrency: { name: 'Ether', symbol: 'ETH', decimals: 18 },
    rpcUrls: ['https://mainnet.base.org'],
    blockExplorerUrls: ['https://basescan.org']
  };

  // ---- Helpers ----
  const $ = id => document.getElementById(id);
  const setStatus = (t, warn=false) => {
    const el = $('status'); if(!el) return;
    el.textContent = t; el.className = warn ? 'warn' : '';
  };
  const showManual = () => { const m = $('manual'); if(m) m.style.display = 'block'; };

  async function ensureBase(eth){
    try {
      await eth.request({ method:'wallet_switchEthereumChain', params:[{ chainId: BASE.chainId }] });
    } catch (e) {
      if (e && e.code === 4902) {
        await eth.request({ method:'wallet_addEthereumChain', params:[BASE] });
        await eth.request({ method:'wallet_switchEthereumChain', params:[{ chainId: BASE.chainId }] });
      } else {
        throw e;
      }
    }
  }

  async function addVida(){
    const eth = window.ethereum;

    // Must be in MetaMask (desktop extension or in-app browser)
    if (!eth || !eth.isMetaMask) {
      setStatus('Open this page inside the MetaMask app (Browser tab) or use desktop with the MetaMask extension.', true);
      showManual(); return;
    }

    try { await eth.request({ method:'eth_requestAccounts' }); } catch {}

    try {
      // 1) Switch to (or add) Base
      setStatus('Switching to Base…');
      await ensureBase(eth);

      // 2) Small pause helps on mobile after network changes
      await new Promise(r => setTimeout(r, 300));

      // 3) Ask MetaMask to watch the token
      setStatus('Adding VIDA to your wallet…');
      const ok = await eth.request({
        method:'wallet_watchAsset',
        params:{ type:'ERC20', options: TOKEN }
      });

      if (ok) {
        setStatus('✅ VIDA was added to your wallet.', false);
      } else {
        setStatus('MetaMask declined to add VIDA.', true);
        showManual();
      }
    } catch(e){
      // Common mobile messages can be noisy; we show a clean fallback.
      setStatus('Could not add automatically. Please use the manual steps below.', true);
      showManual();
    }
  }

  // Auto-run shortly after load
  window.addEventListener('DOMContentLoaded', () => setTimeout(addVida, 250));
  </script>
</body>
</html>
