<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Add VIDA to MetaMask</title>
  <style>
    body{margin:0;background:#0b1c14;color:#d9f7e8;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    .card{max-width:720px;margin:32px auto;padding:24px;background:#10261c;border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.25)}
    h1{margin:0 0 12px;font-size:40px;line-height:1.1}
    p{margin:10px 0 0;color:#bfead6}
    .btn{display:inline-block;margin-top:18px;padding:14px 18px;border-radius:10px;
         background:#39c18f;color:#fff;font-weight:700;text-decoration:none;border:0}
    code{background:#0e1f17;border:1px solid #214734;border-radius:6px;padding:2px 6px}
    .warn{margin-top:12px;color:#ffd38a}
  </style>
</head>
<body>
  <div class="card">
    <h1>Add <span style="color:#7DE3B1">VIDA</span> to MetaMask</h1>
    <p>Tap the button below. If prompted, allow the page to connect.</p>
    <button class="btn" id="add">＋ Add VIDA on Base</button>
    <p class="warn" id="msg"></p>
    <p style="margin-top:18px">
      Contract: <code id="caddr">0x1D929E2422AEC567907f7fE2B966f7f84CA1858F</code><br/>
      Network: <code>Base (chainId 8453 / 0x2105)</code>
    </p>
  </div>

 <div style="display:flex; justify-content:center; text-align:left; margin-top:20px;">
  <div id="manual" style="display:none; max-width:420px; background:#10261c; border:1px solid #254837; border-radius:10px; padding:16px 20px;">
    <p style="text-align:center; font-weight:bold; color:#9ff0c9;">Manually add VIDA to MetaMask (mobile):</p>
    <ol style="margin:0; padding-left:20px; color:#dff6e8; line-height:1.5;">
    <li>Open MetaMask and click the small + icon on the right of the screen.</li>
    <li>Select "Custom"</li>
    <li>Choose <b>Base</b> from the "Select a network" drop-down menu.</li>
    <li>Paste this <code>0x1D929E2422AEC567907f7fE2B966f7f84CA1858F</code> under "Token contract address".</li>
    <li>Select next.</li>
    <li>Press import.</li>
  </ol>
</div>
<p id="msg" style="display:none;margin-top:8px;opacity:.85;"></p>

  <script>
const TOKEN = {
  address: '0x1D929E2422AEC567907f7fE2B966f7f84CA1858F',
  symbol: 'VIDA',
  decimals: 18,
  image: 'https://rawcdn.githack.com/taclarke2020-droid/Vida-Coin-Demo/refs/heads/main/Vida%20coin%20logo.svg'
};
const BASE = {
  chainId: '0x2105', // 8453
  chainName: 'Base',
  nativeCurrency: { name: 'Ether', symbol: 'ETH', decimals: 18 },
  rpcUrls: ['https://mainnet.base.org'],
  blockExplorerUrls: ['https://basescan.org']
};

function $id(id){ return document.getElementById(id); }
function note(t){ const el=$id('msg'); if(el){ el.textContent=t; el.style.display='block'; } }
function showManual(){ const el=$id('manual'); if(el){ el.style.display='block'; } }

async function ensureBase(eth){
  // try switch; if chain missing, add then switch
  try {
    await eth.request({ method:'wallet_switchEthereumChain', params:[{ chainId: BASE.chainId }] });
  } catch(e){
    if(e && e.code === 4902){ // chain not added
      await eth.request({ method:'wallet_addEthereumChain', params:[BASE] });
      await eth.request({ method:'wallet_switchEthereumChain', params:[{ chainId: BASE.chainId }] });
    } else {
      throw e;
    }
  }
}

async function addVida(){
  const eth = window.ethereum;
  if(!eth || !eth.isMetaMask){
    note('Open this page inside the MetaMask mobile app (Browser tab), or use desktop with the MetaMask extension.');
    showManual(); return;
  }
  try { await eth.request({ method:'eth_requestAccounts' }); } catch { /* user denied; keep going */ }

  // 1) ensure Base
  try { await ensureBase(eth); } 
  catch(e){ note('Could not switch to Base. In MetaMask: Settings → Networks → add/enable Base.'); showManual(); return; }

  // 2) small waits help MetaMask mobile settle after a chain change
  await new Promise(r => setTimeout(r, 250));

  // 3) try to add the token (retry once if needed)
  async function watch(){
    return eth.request({
      method: 'wallet_watchAsset',
      params: { type:'ERC20', options: TOKEN }
    });
  }
  try{
    const ok = await watch();
    if(!ok){ note('MetaMask declined to add VIDA.'); showManual(); return; }
  } catch(e1){
    // one retry after a slightly longer wait
    await new Promise(r => setTimeout(r, 600));
    try{
      const ok2 = await watch();
      if(!ok2){ note('MetaMask declined to add VIDA.'); showManual(); }
    } catch(e2){
      note('MetaMask mobile couldn’t add VIDA automatically. Please add it manually below.');
      showManual();
    }
  }
}

window.addEventListener('DOMContentLoaded', () => {
  const btn = $id('addBtn');
  if(btn) btn.addEventListener('click', addVida);

  // Optional: auto-attempt on load when in MetaMask
  if(window.ethereum && window.ethereum.isMetaMask){
    setTimeout(addVida, 300); // give the in-app browser a moment
  }
});
</script>
</body>
</html>
