<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Add VIDA to MetaMask</title>
  <style>
    body{margin:0;background:#0b1c14;color:#d9f7e8;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    .card{max-width:720px;margin:32px auto;padding:24px;background:#10261c;border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.25)}
    h1{margin:0 0 12px;font-size:40px;line-height:1.1}
    p{margin:10px 0 0;color:#bfead6}
    .btn{display:inline-block;margin-top:18px;padding:14px 18px;border-radius:10px;
         background:#39c18f;color:#fff;font-weight:700;text-decoration:none;border:0}
    code{background:#0e1f17;border:1px solid #214734;border-radius:6px;padding:2px 6px}
    .warn{margin-top:12px;color:#ffd38a}
  </style>
</head>
<body>
  <div class="card">
    <h1>Add <span style="color:#7DE3B1">VIDA</span> to MetaMask</h1>
    <p>Tap the button below. If prompted, allow the page to connect.</p>
    <button class="btn" id="add">＋ Add VIDA on Base</button>
    <p class="warn" id="msg"></p>
    <p style="margin-top:18px">
      Contract: <code id="caddr">0x1D929E2422AEC567907f7fE2B966f7f84CA1858F</code><br/>
      Network: <code>Base (chainId 8453 / 0x2105)</code>
    </p>
  </div>

  <script>
    const TOKEN = {
      address: "0x1D929E2422AEC567907f7fE2B966f7f84CA1858F",
      symbol: "VIDA",
      decimals: 18,
      image: "https://cdn.shopify.com/s/files/1/0664/1454/3080/files/Vida_coin_logo.jpg?v=1716912774",
    };

    const BASE_PARAMS = {
      chainId: "0x2105", // ✅ Base mainnet (8453)
      chainName: "Base",
      nativeCurrency: { name: "Ether", symbol: "ETH", decimals: 18 },
      rpcUrls: ["https://mainnet.base.org","https://developer-access-mainnet.base.org"],
      blockExplorerUrls: ["https://basescan.org/"],
    };

    const msg = (t) => document.getElementById('msg').textContent = t || "";

    async function addVida() {
      if (!window.ethereum) {
        msg("MetaMask not detected. Open this page inside MetaMask’s in-app browser.");
        // deep link fallback
        window.location.href =
          "https://metamask.app.link/dapp/" + window.location.host + window.location.pathname + window.location.search;
        return;
      }

      try {
        // 1) Try to switch to Base
        try {
          await window.ethereum.request({ method: "wallet_switchEthereumChain", params: [{ chainId: BASE_PARAMS.chainId }] });
        } catch (err) {
          // If Base not added yet, add it
          if (err && err.code === 4902) {
            await window.ethereum.request({ method: "wallet_addEthereumChain", params: [BASE_PARAMS] });
          } else {
            throw err;
          }
        }

        // 2) Add VIDA token
        const added = await window.ethereum.request({
          method: "wallet_watchAsset",
          params: { type: "ERC20", options: TOKEN }
        });

        msg(added ? "Token added!" : "Request was dismissed.");
      } catch (e) {
        msg(e?.message || "Something went wrong.");
      }
    }

    document.getElementById('add').addEventListener('click', addVida);
  </script>
</body>
</html>
